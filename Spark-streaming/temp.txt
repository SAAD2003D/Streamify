FROM debian:bullseye

# Install Python, Java, procps and other dependencies
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    openjdk-11-jdk \
    procps \
    --no-install-recommends && \
    rm -rf /var/lib/apt/lists/*

# Configure Java Alternatives if needed (Example for OpenJDK 11)
RUN update-alternatives --install /usr/bin/java java /usr/lib/jvm/java-11-openjdk-amd64/bin/java 1
ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64


WORKDIR /app

# Copy consumer requirements
COPY ./requirements.txt /app/requirements.txt
# Install Python dependencies
RUN pip install --no-cache-dir -r /app/requirements.txt

# Copy the rest of the application code
COPY . /app


CMD [ \
    "spark-submit", \
    "--master", "spark://spark-master:7077", \
    "--packages", "org.apache.spark:spark-sql-kafka-0-10_2.12:3.4.0", \
    "consumer.py" \
]
